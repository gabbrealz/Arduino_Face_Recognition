<!DOCTYPE html>
<html>
<head>
    <title>ESP32-CAM Stream</title>
    <style>
        body {
            font-family: Arial;
            text-align: center;
            background: #111;
            color: white;
        }
        img {
            margin-top: 20px;
            border: 3px solid white;
            width: 480px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<h2>ESP32-CAM Live Stream (WebSocket)</h2>

<button onclick="startStream()">Start Stream</button>
<button onclick="stopStream()">Stop Stream</button>
<button onclick="singleCapture()">Capture Once</button>

<br>
<img id="streamImage" />

<script>
    const ws = new WebSocket("ws://192.168.1.168:8000/ws");

    let receiving = false;
    let imageChunks = [];

    ws.binaryType = "arraybuffer";

    ws.onopen = () => {
        console.log("Connected to WebSocket");
    };

    ws.onmessage = (event) => {
        console.log(event);
        
        if (event.data instanceof Blob || event.data instanceof ArrayBuffer) {
            const blob = event.data instanceof Blob ? event.data : new Blob([event.data], { type: "image/jpeg" });
            const imageUrl = URL.createObjectURL(blob);
            document.getElementById("streamImage").src = imageUrl;
        } else {
            console.log("Received text message:", event.data);
        }
    };

    ws.onerror = (err) => {
        console.error("WebSocket error:", err);
    };

    ws.onclose = () => {
        console.log("WebSocket closed");
    };

    function startStream() {
        ws.send("STREAM ON");
    }

    function stopStream() {
        ws.send("STREAM OFF");
    }

    function singleCapture() {
        ws.send("CAPTURE");
    }
</script>

</body>
</html>